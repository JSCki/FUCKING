<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Runtime HTML Sniffer</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; margin: 0; padding: 0; }
    input[type="file"] { margin: 10px; }
    iframe, pre { width: 100%; box-sizing: border-box; }
    iframe { height: 400px; border: 2px solid #444; background: #fff; }
    pre { background: #222; color: #0f0; padding: 10px; height: 200px; overflow-y: auto; margin: 0; }
    h2, h3 { margin: 10px; }
  </style>
</head>
<body>
  <h2>üß† Runtime HTML File Sniffer</h2>
  <input type="file" id="fileInput" accept=".html">

  <h3>üåê Webpage Preview:</h3>
  <iframe id="preview"></iframe>

  <h3>üìú Captured Runtime Code:</h3>
  <pre id="log"></pre>

  <script>
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const logBox = document.getElementById('log');

    fileInput.addEventListener('change', async function () {
      const file = this.files[0];
      if (!file) return;

      const content = await file.text();

      const injected = `<!DOCTYPE html><html><head><script>
        const log = (type, content) => parent.postMessage({ type, content }, '*');
        eval = new Proxy(eval, { apply: (t, _, a) => (log('eval', a[0]), t(...a)) });
        Function = new Proxy(Function, { construct: (t, a) => (log('Function', a.join(',')), new t(...a)) });
        document.write = new Proxy(document.write, { apply: (t, _, a) => (log('document.write', a[0]), t.apply(document, a)) });
        const d = Object.getOwnPropertyDescriptor(Element.prototype, 'innerHTML');
        Object.defineProperty(Element.prototype, 'innerHTML', {
          set(v) { log('innerHTML', v); return d.set.call(this, v); },
          get() { return d.get.call(this); }
        });
        fetch = new Proxy(fetch, {
          apply(t, _, a) {
            log('fetch', JSON.stringify(a));
            return t(...a).then(r => r.clone().text().then(txt => (log('fetch response', txt), r)));
          }
        });
        XMLHttpRequest.prototype.open = new Proxy(XMLHttpRequest.prototype.open, {
          apply(t, self, a) { self._url = a[1]; return t.apply(self, a); }
        });
        XMLHttpRequest.prototype.send = new Proxy(XMLHttpRequest.prototype.send, {
          apply(t, self, a) {
            self.addEventListener('load', () => log('xhr', self._url + '\\n' + self.responseText));
            return t.apply(self, a);
          }
        });
      <\\/script></head><body>${content}</body></html>`;

      const blob = new Blob([injected], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      preview.src = url;
    });

    window.addEventListener('message', e => {
      logBox.textContent += `üîπ ${e.data.type}:\n${e.data.content}\n----------------------\n`;
    });
  </script>
</body>
</html>